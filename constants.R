# global constants available to the app
# last update: 2017-06-11

# required Libraries
library(shiny)
library(shinyjs)
library(shinyBS)
library(rintrojs)
library(sodium)
library(oydapp)
library(shinyAce)
library(shinyWidgets)

# sources for user specific UI
source('uiBody.R')

# constants required for every app
appName <- 'answers'
appTitle <- 'Questions & Answers'
app_id <- 'oyd.answers'
appRepoDefault <- 'oyd.settings'
helpUrl <- 'https://www.ownyourdata.eu/apps/answers'

# console logging
oydLog <- function(msg)
        cat(paste(Sys.time(), msg, "\n"))
oydLog('App start')

# Version information
currVersion <- "0.3.0"
verHistory <- data.frame(rbind(
        c(version = "0.3.0",
          text    = "erstes Release")
))

# translations for app specific localizations
localization <- list(
        'ctrlTrnsl_appTitle' = list('de' = 'Fragen & Antworten', 
                                    'en' = 'Questions & Answers'),
        'missingKey' = list('de' = 'Fehlendes Passwort',
                            'en' = 'Missing Key'),
        'missingKeyInfo' = list('de' = 'Es fehlt das Passwort zum EntschlÃ¼sseln deiner Daten! Verwende das Menu "Einstellungen" rechts oben, um das Passwort einzugeben.',
                                'en' = 'The key to decrypt your data is missing! Use the settings menu in the upper right corner, to enter the key.')
)

map_view_part <- '## Besuchte Orte

Auf der folgenden Landkarte sind die von dir zuletzt besuchten Orte eingetragen.
```{r, echo=FALSE, out.width="100%"}
library(methods)
library(leaflet)
library(webshot)
library(htmlwidgets)
library(mapview)
library(shiny)

uiOutput("mymap")
```
'        

map_logic_part <- 'output$mymap <- renderUI({
        my_lat <- c(48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574769, 48.1641882, 48.1641882, 48.1641882, 47.9574633, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574769, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574769, 48.1641882, 48.1641882, 48.1641882, 47.963032, 47.963032, 48.1641882, 47.9574619, 47.9574651, 47.9574615, 47.963032, 47.9574619, 47.9574651, 47.9574615, 47.9574769, 47.9574769, 48.1641882, 48.1641882, 47.963032, 47.963032, 47.9574619, 47.9574651, 48.1641882, 47.963032, 47.9574619, 47.9574619, 47.9574651, 47.9574651, 47.9574651, 47.9574615, 48.1641882, 47.9574619, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574615, 48.1641882, 47.9574615, 48.1641882, 48.1641882, 48.1641882, 47.9574769, 47.9574633, 47.9574633, 47.9574633, 47.9574633, 48.1641882, 47.9574633, 47.9574802, 47.9574802, 47.9574802, 47.9574802, 47.9574802, 47.9574619, 48.1641882, 48.1641882, 48.1641882, 47.9574615, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574802, 47.9575688, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574813, 47.9575688, 47.9635128, 47.9635128, 47.9635128, 47.9635128, 47.9637323, 47.9637323, 47.95748194, 47.95748194, 47.9577067, 47.9574743, 47.9574743, 47.9575688, 47.9574813, 47.9575688, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9575688, 47.9574619, 47.9574619, 47.9574619, 47.9575688, 47.9577067, 47.9575688, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574809, 47.9574809, 47.95748, 48.1641868, 47.95748, 48.1641891, 48.1641868, 48.1641866, 48.1641866, 48.1641869, 48.1641872, 48.164188, 48.1641878, 48.1641887, 48.164185, 48.1641901, 48.1641869, 48.1641872, 48.164188, 48.1641878, 48.1641887, 48.164185, 48.1641901, 48.1641776, 48.1641979, 48.1641901, 48.1641776, 48.1641979, 48.1641901, 47.9574746, 47.9574746, 47.957476, 47.957476, 47.9574619, 47.9574619, 47.9575688, 47.9575688, 47.9575688, 47.9575688, 47.9574619, 47.9574619)
my_long  <- c(16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.213942, 16.3339065, 16.3339065, 16.3339065, 16.2140784, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.213942, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.213942, 16.3339065, 16.3339065, 16.3339065, 16.1979866, 16.1979866, 16.3339065, 16.2140702, 16.2137693, 16.2140367, 16.1979866, 16.2140702, 16.2137693, 16.2140367, 16.213942, 16.213942, 16.3339065, 16.3339065, 16.1979866, 16.1979866, 16.2140702, 16.2137693, 16.3339065, 16.1979866, 16.2140702, 16.2140702, 16.2137693, 16.2137693, 16.2137693, 16.2140367, 16.3339065, 16.2140702, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.2140367, 16.3339065, 16.2140367, 16.3339065, 16.3339065, 16.3339065, 16.213942, 16.2140784, 16.2140784, 16.2140784, 16.2140784, 16.3339065, 16.2140784, 16.214053, 16.214053, 16.214053, 16.214053, 16.214053, 16.2140702, 16.3339065, 16.3339065, 16.3339065, 16.2140367, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.214053, 16.2141884, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140556, 16.2141884, 16.2030776, 16.2030776, 16.2030776, 16.2030776, 16.2033609, 16.2033609, 16.2140331, 16.2140331, 16.21404961, 16.2140882, 16.2140882, 16.2141884, 16.2140556, 16.2141884, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2141884, 16.2140702, 16.2140702, 16.2140702, 16.2141884, 16.21404961, 16.2141884, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140436, 16.2140436, 16.2140024, 16.3339031, 16.2140024, 16.333907, 16.3339031, 16.333903, 16.333903, 16.3339035, 16.3339031, 16.3339053, 16.3339049, 16.3339061, 16.3339187, 16.3339245, 16.3339035, 16.3339031, 16.3339053, 16.3339049, 16.3339061, 16.3339187, 16.3339245, 16.3338934, 16.3339247, 16.333908, 16.3338934, 16.3339247, 16.333908, 16.2140923, 16.2140923, 16.2140831, 16.2140831, 16.2140702, 16.2140702, 16.2141884, 16.2141884, 16.2141884, 16.2141884, 16.2140702, 16.2140702)
my_ts <- c(1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523972471, 1523891356, 1523891356, 1523891356, 1523973330, 1523891356, 1523891356, 1523891356, 1523891356, 1523972471, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523972471, 1523891356, 1523891356, 1523891356, 1523967235, 1523967235, 1523891356, 1523969503, 1523970506, 1523971347, 1523967235, 1523969503, 1523970506, 1523971347, 1523972471, 1523972471, 1523891356, 1523891356, 1523967235, 1523967235, 1523969503, 1523970506, 1523891356, 1523967235, 1523969503, 1523969503, 1523970506, 1523970506, 1523970506, 1523971347, 1523891356, 1523969503, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523971347, 1523891356, 1523971347, 1523891356, 1523891356, 1523891356, 1523972471, 1523973330, 1523973330, 1523973330, 1523973330, 1523891356, 1523973330, 1523973410, 1523973410, 1523973410, 1523973409, 1523973410, 1524042931, 1523891356, 1523891356, 1523891356, 1523971347, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523973410, 1524041910, 1524043846, 1524043846, 1524044751, 1524044751, 1524045656, 1524045656, 1524047534, 1524047534, 1524048452, 1524048452, 1524046614, 1524050323, 1524051273, 1524055052, 1524055052, 1524055159, 1524055159, 1524056897, 1524056897, 1524057801, 1524057801, 1524062856, 1524062862, 1524062862, 1524064203, 1524050323, 1524064696, 1524075875, 1524075875, 1524078694, 1524078694, 1524079605, 1524079605, 1524088233, 1524089249, 1524090280, 1524090281, 1524064203, 1524090522, 1524042931, 1524046614, 1524051273, 1524062856, 1524064696, 1524089249, 1524090523, 1524095934, 1524095934, 1524102616, 1524102616, 1524116824, 1524116824, 1524119533, 1524128338, 1524119533, 1524126869, 1524128337, 1524128910, 1524128910, 1524130204, 1524131277, 1524132304, 1524133386, 1524134410, 1524135323, 1524136225, 1524130204, 1524131277, 1524132304, 1524133386, 1524134410, 1524135323, 1524136225, 1524137200, 1524140479, 1524148001, 1524137200, 1524140479, 1524148001, 1524161850, 1524161850, 1524162801, 1524162801, 1524163943, 1524163943, 1524164761, 1524164761, 1524164930, 1524164930, 1524167301, 1524167301)
tagList(
sliderInput("time_slider", 
label = h3("Zeitraum"), 
min = as.POSIXct(min(my_ts), origin="1970-01-01"), 
max = as.POSIXct(max(my_ts), origin="1970-01-01"), 
value = c(as.POSIXct(min(my_ts), origin="1970-01-01"), 
as.POSIXct(max(my_ts), origin="1970-01-01"))),
renderLeaflet({
points <- cbind(my_long[my_ts >= as.integer(as.POSIXct(input$time_slider[1])) &
my_ts <= as.integer(as.POSIXct(input$time_slider[2]))],
my_lat[my_ts >= as.integer(as.POSIXct(input$time_slider[1])) &
my_ts <= as.integer(as.POSIXct(input$time_slider[2]))])
leaflet(points) %>% 
addProviderTiles(providers$CartoDB.Positron) %>% 
addMarkers()
})
)
})
'

mrmd2 <- '## Besuchte Orte

Auf der folgenden Landkarte sind die von dir zuletzt besuchten Orte eingetragen.
```{r, echo=FALSE, out.width="100%"}
library(methods)
library(leaflet)
library(webshot)
library(htmlwidgets)
library(mapview)
library(shiny)

my_lat <- c(48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574769, 48.1641882, 48.1641882, 48.1641882, 47.9574633, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574769, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574769, 48.1641882, 48.1641882, 48.1641882, 47.963032, 47.963032, 48.1641882, 47.9574619, 47.9574651, 47.9574615, 47.963032, 47.9574619, 47.9574651, 47.9574615, 47.9574769, 47.9574769, 48.1641882, 48.1641882, 47.963032, 47.963032, 47.9574619, 47.9574651, 48.1641882, 47.963032, 47.9574619, 47.9574619, 47.9574651, 47.9574651, 47.9574651, 47.9574615, 48.1641882, 47.9574619, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574615, 48.1641882, 47.9574615, 48.1641882, 48.1641882, 48.1641882, 47.9574769, 47.9574633, 47.9574633, 47.9574633, 47.9574633, 48.1641882, 47.9574633, 47.9574802, 47.9574802, 47.9574802, 47.9574802, 47.9574802, 47.9574619, 48.1641882, 48.1641882, 48.1641882, 47.9574615, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 48.1641882, 47.9574802, 47.9575688, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574813, 47.9575688, 47.9635128, 47.9635128, 47.9635128, 47.9635128, 47.9637323, 47.9637323, 47.95748194, 47.95748194, 47.9577067, 47.9574743, 47.9574743, 47.9575688, 47.9574813, 47.9575688, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9575688, 47.9574619, 47.9574619, 47.9574619, 47.9575688, 47.9577067, 47.9575688, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574619, 47.9574809, 47.9574809, 47.95748, 48.1641868, 47.95748, 48.1641891, 48.1641868, 48.1641866, 48.1641866, 48.1641869, 48.1641872, 48.164188, 48.1641878, 48.1641887, 48.164185, 48.1641901, 48.1641869, 48.1641872, 48.164188, 48.1641878, 48.1641887, 48.164185, 48.1641901, 48.1641776, 48.1641979, 48.1641901, 48.1641776, 48.1641979, 48.1641901, 47.9574746, 47.9574746, 47.957476, 47.957476, 47.9574619, 47.9574619, 47.9575688, 47.9575688, 47.9575688, 47.9575688, 47.9574619, 47.9574619)
my_long  <- c(16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.213942, 16.3339065, 16.3339065, 16.3339065, 16.2140784, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.213942, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.213942, 16.3339065, 16.3339065, 16.3339065, 16.1979866, 16.1979866, 16.3339065, 16.2140702, 16.2137693, 16.2140367, 16.1979866, 16.2140702, 16.2137693, 16.2140367, 16.213942, 16.213942, 16.3339065, 16.3339065, 16.1979866, 16.1979866, 16.2140702, 16.2137693, 16.3339065, 16.1979866, 16.2140702, 16.2140702, 16.2137693, 16.2137693, 16.2137693, 16.2140367, 16.3339065, 16.2140702, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.2140367, 16.3339065, 16.2140367, 16.3339065, 16.3339065, 16.3339065, 16.213942, 16.2140784, 16.2140784, 16.2140784, 16.2140784, 16.3339065, 16.2140784, 16.214053, 16.214053, 16.214053, 16.214053, 16.214053, 16.2140702, 16.3339065, 16.3339065, 16.3339065, 16.2140367, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.3339065, 16.214053, 16.2141884, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140556, 16.2141884, 16.2030776, 16.2030776, 16.2030776, 16.2030776, 16.2033609, 16.2033609, 16.2140331, 16.2140331, 16.21404961, 16.2140882, 16.2140882, 16.2141884, 16.2140556, 16.2141884, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2141884, 16.2140702, 16.2140702, 16.2140702, 16.2141884, 16.21404961, 16.2141884, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140702, 16.2140436, 16.2140436, 16.2140024, 16.3339031, 16.2140024, 16.333907, 16.3339031, 16.333903, 16.333903, 16.3339035, 16.3339031, 16.3339053, 16.3339049, 16.3339061, 16.3339187, 16.3339245, 16.3339035, 16.3339031, 16.3339053, 16.3339049, 16.3339061, 16.3339187, 16.3339245, 16.3338934, 16.3339247, 16.333908, 16.3338934, 16.3339247, 16.333908, 16.2140923, 16.2140923, 16.2140831, 16.2140831, 16.2140702, 16.2140702, 16.2141884, 16.2141884, 16.2141884, 16.2141884, 16.2140702, 16.2140702)
my_ts <- c(1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523972471, 1523891356, 1523891356, 1523891356, 1523973330, 1523891356, 1523891356, 1523891356, 1523891356, 1523972471, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523972471, 1523891356, 1523891356, 1523891356, 1523967235, 1523967235, 1523891356, 1523969503, 1523970506, 1523971347, 1523967235, 1523969503, 1523970506, 1523971347, 1523972471, 1523972471, 1523891356, 1523891356, 1523967235, 1523967235, 1523969503, 1523970506, 1523891356, 1523967235, 1523969503, 1523969503, 1523970506, 1523970506, 1523970506, 1523971347, 1523891356, 1523969503, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523971347, 1523891356, 1523971347, 1523891356, 1523891356, 1523891356, 1523972471, 1523973330, 1523973330, 1523973330, 1523973330, 1523891356, 1523973330, 1523973410, 1523973410, 1523973410, 1523973409, 1523973410, 1524042931, 1523891356, 1523891356, 1523891356, 1523971347, 1523891356, 1523891356, 1523891356, 1523891356, 1523891356, 1523973410, 1524041910, 1524043846, 1524043846, 1524044751, 1524044751, 1524045656, 1524045656, 1524047534, 1524047534, 1524048452, 1524048452, 1524046614, 1524050323, 1524051273, 1524055052, 1524055052, 1524055159, 1524055159, 1524056897, 1524056897, 1524057801, 1524057801, 1524062856, 1524062862, 1524062862, 1524064203, 1524050323, 1524064696, 1524075875, 1524075875, 1524078694, 1524078694, 1524079605, 1524079605, 1524088233, 1524089249, 1524090280, 1524090281, 1524064203, 1524090522, 1524042931, 1524046614, 1524051273, 1524062856, 1524064696, 1524089249, 1524090523, 1524095934, 1524095934, 1524102616, 1524102616, 1524116824, 1524116824, 1524119533, 1524128338, 1524119533, 1524126869, 1524128337, 1524128910, 1524128910, 1524130204, 1524131277, 1524132304, 1524133386, 1524134410, 1524135323, 1524136225, 1524130204, 1524131277, 1524132304, 1524133386, 1524134410, 1524135323, 1524136225, 1524137200, 1524140479, 1524148001, 1524137200, 1524140479, 1524148001, 1524161850, 1524161850, 1524162801, 1524162801, 1524163943, 1524163943, 1524164761, 1524164761, 1524164930, 1524164930, 1524167301, 1524167301)

renderLeaflet({
points <- cbind(my_long,my_lat)
leaflet(points) %>% 
addProviderTiles(providers$CartoDB.Positron) %>% 
addMarkers()
})

```
'        